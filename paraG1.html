<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ocean Game - Stable Light</title>
<style>
  body { margin:0; overflow:hidden; background:#003344; }
</style>
</head>
<body>
<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.158/build/three.module.js";
import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.158/examples/jsm/loaders/GLTFLoader.js";

<<<<<<< HEAD
=======
<<<<<<< HEAD
/* ========= シーン ========= */
=======
const loader = new GLTFLoader();

loader.load("はらちゃん.glb", (gltf) => {
  scene.add(gltf.scene);
});

>>>>>>> 9ad00c23a3faa5e57efc8f4f32acd69587e18cab
/* ---------------- シーン ---------------- */
>>>>>>> f42d513e1d51bbc9b0fcbfd450087c3b44edeaa3
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x003344, 80, 350); // ← 前の落ち着いた霧

/* ========= カメラ ========= */
const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 800);
camera.position.set(0, 4, 10);

/* ========= レンダラー ========= */
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.setClearColor(0x003344);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* ========= 光（見える基準） ========= */
scene.add(new THREE.AmbientLight(0x88ccff, 0.9));
const light = new THREE.DirectionalLight(0xffffff, 0.8);
light.position.set(10, 20, 10);
scene.add(light);

/* ========= 海底 ========= */
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(600,600),
  new THREE.MeshStandardMaterial({ color:0x224444 })
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

/* ========= プレイヤー ========= */
const player = new THREE.Mesh(
  new THREE.SphereGeometry(0.5, 16, 16),
  new THREE.MeshStandardMaterial({ color:0xffffaa })
);
player.position.set(0,1,0);
scene.add(player);

/* ========= WASD ========= */
const keys = {};
addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);

/* ========= 海藻（装飾） ========= */
const seaweeds=[];
for(let i=0;i<80;i++){
  const w = new THREE.Mesh(
    new THREE.CylinderGeometry(0.06,0.12,5,6),
    new THREE.MeshStandardMaterial({ color:0x228833 })
  );
  w.position.set(
    (Math.random()-0.5)*300,
    2.5,
    (Math.random()-0.5)*300
  );
  w.userData.o=Math.random()*Math.PI*2;
  seaweeds.push(w);
  scene.add(w);
}

/* ========= 岩 ========= */
for(let i=0;i<30;i++){
  const rock = new THREE.Mesh(
    new THREE.DodecahedronGeometry(1+Math.random()),
    new THREE.MeshStandardMaterial({ color:0x666666 })
  );
  rock.position.set(
    (Math.random()-0.5)*200,
    1,
    (Math.random()-0.5)*200
  );
  scene.add(rock);
}

/* ========= エネミー（仮→GLB） ========= */
const enemies=[];
function spawnEnemy(obj){
  obj.position.set(
    (Math.random()-0.5)*80,
    1,
    (Math.random()-0.5)*80
  );
  scene.add(obj);
  enemies.push(obj);
}

/* 仮エネミー */
for(let i=0;i<5;i++){
  spawnEnemy(new THREE.Mesh(
    new THREE.BoxGeometry(1,1,1),
    new THREE.MeshStandardMaterial({ color:0xff4444 })
  ));
}

/* GLBあれば差し替え */
const loader=new GLTFLoader();
loader.load(
  "models/enemy.glb",
  g=>{
    enemies.forEach(e=>scene.remove(e));
    enemies.length=0;
    for(let i=0;i<5;i++) spawnEnemy(g.scene.clone());
  },
  undefined,
  ()=>{}
);

/* ========= ループ ========= */
const clock=new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);
  const t=clock.getElapsedTime();

  const speed=0.1;
  if(keys["w"]) player.position.z-=speed;
  if(keys["s"]) player.position.z+=speed;
  if(keys["a"]) player.position.x-=speed;
  if(keys["d"]) player.position.x+=speed;

  camera.position.lerp(
    new THREE.Vector3(
      player.position.x,
      player.position.y+4,
      player.position.z+10
    ),0.1
  );
  camera.lookAt(player.position);

  seaweeds.forEach(w=>{
    w.rotation.z=Math.sin(t+w.userData.o)*0.25;
  });

  renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>