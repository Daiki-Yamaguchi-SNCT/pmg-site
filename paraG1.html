<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>もちキャララッシュ</title>
<style>
body { margin:0; overflow:hidden; background:#8fd3ff; }
#ui{
 position:absolute;
 top:15px;
 left:15px;
 font-size:22px;
 color:#fff;
 text-shadow:0 0 8px rgba(0,0,0,0.6);
}
#over{
 position:absolute;
 inset:0;
 display:none;
 align-items:center;
 justify-content:center;
 flex-direction:column;
 background:rgba(0,0,0,0.6);
 color:white;
 font-size:28px;
}
button{
 font-size:20px;
 padding:10px 20px;
 margin-top:15px;
}
</style>
</head>
<body>

<div id="ui">Score: 0</div>
<div id="over">
 <div>GAME OVER</div>
 <button onclick="location.reload()">もう一回</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script>
// ===== 基本 =====
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x6ec6ff);

let camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 100);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// 光
scene.add(new THREE.AmbientLight(0xffffff, 1));
let light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5,10,5);
scene.add(light);

// ===== キャラ（あなたのオリジナル）=====
let tex = new THREE.TextureLoader().load("はらちゃん.png");
let chara = new THREE.Sprite(
 new THREE.SpriteMaterial({ map: tex, transparent:true })
);
chara.scale.set(1.5,1.5,1);
scene.add(chara);

// ===== エサ =====
let food = new THREE.Mesh(
 new THREE.SphereGeometry(0.3,16,16),
 new THREE.MeshStandardMaterial({color:0xffee55, emissive:0xffee55})
);
scene.add(food);

// ===== 変数 =====
let score = 0;
let speed = 0.08;
let targetX = 0;
let gameOver = false;

// 配置
function moveFood(){
 food.position.set(
  (Math.random()-0.5)*6,
  (Math.random()-0.5)*4,
  chara.position.z - 5
 );
}
moveFood();

// タップ / クリック操作
function input(e){
 let x = (e.touches?e.touches[0].clientX:e.clientX)/innerWidth;
 targetX = (x-0.5)*6;
}
addEventListener("touchstart", input);
addEventListener("mousedown", input);

// ===== ループ =====
function loop(){
 if(gameOver) return;
 requestAnimationFrame(loop);

 // 移動
 chara.position.x += (targetX - chara.position.x)*0.1;
 chara.position.z -= speed;

 camera.position.z = chara.position.z + 5;
 camera.position.x = chara.position.x;

 // 回収
 if(chara.position.distanceTo(food.position) < 0.8){
  score++;
  speed += 0.015; // ← 中毒性
  document.getElementById("ui").textContent = "Score: " + score;
  moveFood();
 }

 // 画面外＝死亡
 if(Math.abs(chara.position.x) > 4){
  document.getElementById("over").style.display="flex";
  gameOver = true;
 }

 renderer.render(scene,camera);
}
loop();

// 画面対応
addEventListener("resize", ()=>{
 camera.aspect = innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>
