<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Arena Game</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:#87CEEB;
  font-family:sans-serif;
}
#ui{
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  font-size:20px;
  text-shadow:0 0 5px black;
}
#gameover{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  color:white;
  font-size:40px;
  text-align:center;
  display:none;
}
button{
  font-size:24px;
  padding:10px 20px;
}
</style>

</head>
<body>

<div id="ui">
Score: <span id="score">0</span>
</div>

<div id="gameover">
GAME OVER<br>
<button onclick="restart()">RESTART</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
let scene,camera,renderer;
let player;
let items=[];
let enemies=[];
let score=0;
let gameOver=false;
let difficulty=1;

init();
animate();

function init(){

scene=new THREE.Scene();

camera=new THREE.PerspectiveCamera(
75,
window.innerWidth/window.innerHeight,
0.1,
1000
);
camera.position.set(0,12,12);
camera.lookAt(0,0,0);

renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
const light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,7);
scene.add(light);

scene.add(new THREE.AmbientLight(0xffffff,0.7));

// Floor
const floor=new THREE.Mesh(
new THREE.CircleGeometry(15,32),
new THREE.MeshStandardMaterial({color:0x66ccff})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

// ===== プレイヤー（画像スプライト） =====
// ★ここを自分のキャラ画像に変更できる
const texture=new THREE.TextureLoader().load("はらちゃん.png");

const mat=new THREE.SpriteMaterial({map:texture});
player=new THREE.Sprite(mat);
player.scale.set(2,2,1);
player.position.y=1;
scene.add(player);

// 初期スポーン
for(let i=0;i<5;i++) spawnItem();
for(let i=0;i<3;i++) spawnEnemy();

// 操作
window.addEventListener("pointerdown",movePlayer);
window.addEventListener("resize",onResize);

}

function spawnItem(){
const mesh=new THREE.Mesh(
new THREE.SphereGeometry(0.5,16,16),
new THREE.MeshStandardMaterial({color:0xffff00})
);

let angle=Math.random()*Math.PI*2;
let radius=8+Math.random()*5;

mesh.position.set(
Math.cos(angle)*radius,
0.5,
Math.sin(angle)*radius
);

scene.add(mesh);
items.push(mesh);
}

function spawnEnemy(){
const mesh=new THREE.Mesh(
new THREE.BoxGeometry(1,1,1),
new THREE.MeshStandardMaterial({color:0xff3333})
);

let angle=Math.random()*Math.PI*2;
let radius=8+Math.random()*5;

mesh.position.set(
Math.cos(angle)*radius,
0.5,
Math.sin(angle)*radius
);

scene.add(mesh);
enemies.push(mesh);
}

function movePlayer(e){

if(gameOver) return;

let x=(e.clientX/window.innerWidth)*2-1;
let z=(e.clientY/window.innerHeight)*2-1;

player.position.x=x*10;
player.position.z=z*10;
}

function animate(){
requestAnimationFrame(animate);

if(!gameOver){
updateGame();
}

renderer.render(scene,camera);
}

function updateGame(){

// ===== 当たり判定 =====

// アイテム
items.forEach((item,i)=>{
if(item.position.distanceTo(player.position)<1.5){
scene.remove(item);
items.splice(i,1);
score++;
document.getElementById("score").textContent=score;

spawnItem();

// 難易度アップ
difficulty+=0.05;
if(Math.random()<0.5){
spawnEnemy();
}
}
});

// 敵
enemies.forEach(enemy=>{

enemy.position.x+=Math.sin(Date.now()*0.001)*0.02*difficulty;
enemy.position.z+=Math.cos(Date.now()*0.001)*0.02*difficulty;

if(enemy.position.distanceTo(player.position)<1.5){
endGame();
}
});

}

function endGame(){
gameOver=true;
document.getElementById("gameover").style.display="block";
}

function restart(){
location.reload();
}

function onResize(){
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
}
</script>

</body>
</html>
